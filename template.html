<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Honouring the Truth, Reconciling for the Future, Summary of the Final Report of the Truth and Reconciliation Commission of Canada | Unofficial web version</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
<script>

  var PDF_PAGE_OFFSET = -6,
      REPORT_BASE = 'https://docs.google.com/forms/d/1b3BHh2tI85uf0q36lrm1iIXO7Y2sYr8opusXHOjYLOc/viewform',
      YT_BASE = 'https://www.youtube-nocookie.com/embed/',
      YT_OPTS = '?showinfo=0&amp;autoplay=1';

  var control = {},
      controlOffset,
      currentId;

  window.addEventListener('load', function() {
    initTools();
    updateGeom();
    window.addEventListener('resize', updateGeom);
    document.body.addEventListener('mouseover', hoverSomething);
    document.body.addEventListener('click', hoverSomething);  // for mobile
    document.body.addEventListener('mouseout', leaveSomething);
    control.watch.addEventListener('click', playVideo);
  });

  function offsetTop(el) {
    for (var y=el.offsetTop; el=el.offsetParent; y += el.offsetTop);
    return y;
  }

  function updateGeom() {
    controlOffset = -offsetTop(control.col);
  }

  function initTools() {
    control.col = document.querySelector('.control-col')
    control.box = document.querySelector('.control');
    control.p = control.box.querySelector('.pageno');
    control.share = control.box.querySelector('.sharelink');
    control.watch = control.box.querySelector('.watchlink');
    control.report = control.box.querySelector('.reportlink');
    control.video = control.box.querySelector('.video');
  }

  function hoverSomething(e) {
    var dataP = null,
        t = e.target;
    while (!(dataP = t.getAttribute('data-p'))) {
      if ((t = t.parentNode) === document) { return; }
    }
    currentId = t.id;
    var pages = t.getAttribute('data-p').split(' ')
      .map(function(p) { return parseInt(p) + PDF_PAGE_OFFSET; });

    control.box.style.display = 'block';
    control.box.style.top = offsetTop(t) + controlOffset + 'px';

    control.share.href = '#' + currentId;

    control.report.href = [
      REPORT_BASE,
      [
        ['entry.545447823', pages.join(',')].join('='),
        ['entry.1968688779', currentId].join('='),
      ].join('&'),
    ].join('?');

    control.p.innerHTML = pages.join(', ');

  }

  function minsToSeconds(s) {
    var z = s.split(':').map(function(n) { return parseInt(n); });
    return z[0] * 60 + z[1];
  }

  function playVideo(e) {
    e.preventDefault();
    var target = document.getElementById(currentId),
        candidates = Array.prototype.slice.apply(document.querySelectorAll('[data-p]')),
        candidate_i = candidates.indexOf(target),
        vid;

    while (!(vid = V_BY_ID[candidates[candidate_i].id]) && candidate_i--);

    var marker = null;
    vid.markers.forEach(function(m, i) {
      if (m.id === candidates[candidate_i].id) {
        marker = m.end ? m.t ? m : vid.markers[i-1] : m;
      }
    });
    var tParam = '&amp;start=' + minsToSeconds(marker.t),
        embedURL = [YT_BASE, vid.yt, YT_OPTS, tParam].join('');


    var embed = document.createElement('iframe');
    embed.setAttribute('width', 560);
    embed.setAttribute('height', 315);
    embed.setAttribute('frameborder', 0);
    embed.setAttribute('allowfullscreen', true);
    embed.setAttribute('src', embedURL);
    control.video.innerHTML = '';
    control.video.appendChild(embed);
    miniRecord('video', [target.id]);
  }

  function leaveSomething(e) {
  }

</script>

<div class="wrap">

  <div class="doc">
    <header>
      <h1>Honouring the Truth, Reconciling for the Future</h1>
      <h2>Summary of the Final Report of the Truth and Reconciliation Commission of Canada</h2>
      <p>This web version of the Report is an <a href="https://github.com/uniphil/trc-plaintext">unofficial plain-text extract</a> of the <a href="http://www.trc.ca/websites/trcinstitution/File/2015/Findings/Exec_Summary_2015_05_31_web_o.pdf">original</a>(PDF, 14MB) published by the <a href="http://trc.ca">The Truth and Reconciliation Commission of Canada</a>.</p>
      <p>It is aimed at making the Report more accessible.</p>
    </header>
    <h1>Contents</h1>
    {contents}
  </div>

  <div class="control-col">
    <div class="control">
      <div class="interact">
        <ul class="buttons">
          <li><a class="sharelink" title="Permanent link">¶</a></li>
          <li><a class="watchlink" title="Watch and listen to this section via #ReadTheTRCReport" href="#">▶</a></li>
          <li><a class="reportlink" title="Report formatting issue" target="_blank">!</a></li>
        </ul>
        <div class="video">
        </div>
      </div>
      <p class="page">p. <span class="pageno"></span></p>
    </div>
  </div>

  <div class="video"></div>

</div>

<script>
  var VIDEOS = {videos},
      V_BY_ID = {};

  VIDEOS.forEach(function(vidStuff) {
    if (!vidStuff.markers) { return; }
    vidStuff.markers.forEach(function(marker) {
      V_BY_ID[marker.id] = vidStuff;
    });
  });
</script>

<img src="https://timekeep-server.herokuapp.com/count.gif" style="position: absolute; left: -9999em" alt="visitor counter" aria-hidden="true" />
</body>
</html>
